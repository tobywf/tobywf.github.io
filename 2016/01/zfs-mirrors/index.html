
<!DOCTYPE html>
<html lang="en">
<head>
  <title>How I stopped worrying and learned to love ZFS and mirrors. - tobywf</title>
  <meta charset="utf-8" />
  <meta name="author" content="Toby Fleming" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:300,300italic,700|Source+Code+Pro:400,700|Montserrat:400" type="text/css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
  <link rel="icon" href="/images/favicon.png" />
  <link rel="stylesheet" href="/asset/main.css">
</head>
<body>
  <div class="wrapper">
    <nav>
      <ul>
<!-- breadcrumbs start -->
<li><a href="/" class="cap">tobywf</a></li>
<li class="breadcrumb"><a href="/2016/">&#x27;16</a></li>
<li class="breadcrumb"><a href="/2016/01/">Jan</a></li>
<li class="portfolio"><a href="/portfolio/" class="cap">portfolio</a></li>
<!-- breadcrumbs end -->
      </ul>
    </nav>
<!-- content start -->
<header class="post-head">
  <h1>How I stopped worrying and learned to love ZFS and mirrors.</h1>
  <div class="infoline">
    <span class="fa fa-calendar"></span> <span class="date">15 Jan &#x27;16</span>
  </div>
</header>
<article>
<p>A cheesy title for a reply to a cheesy-titled post: <a href="http://louwrentius.com/the-hidden-cost-of-using-zfs-for-your-home-nas.html">The &#8216;Hidden&#8217; Cost of Using <span class="caps">ZFS</span> for Your Home <span class="caps">NAS</span></a>. I actually agree with the post, there&#8217;s no ideal solution. I&#8217;ve seen many people put off by the complexity and upfront costs of a 4-drive <span class="caps">RAIDZ2</span>&nbsp;configuration.</p>
<p>For entry-level home <span class="caps">NAS</span> users, the solution is easy though. My advice is to &#8220;just use a mirror&#8221;. Seriously. Your data is valuable, who cares about 50% space efficiency vs. 33% efficiency - if you can put that kind of price on your data, why are you reading this post? And mirrors work as you expect. This is also true for read/write performance, although I admit this isn&#8217;t a priority for most entry-level <span class="caps">NAS</span>.</p>
<p><span class="dquo">&#8220;</span>But Toby, a mirror doesn&#8217;t provide the same level of protection as four drives in <span class="caps">RAIDZ2</span>!&#8221;. That is correct, but also usually irrelevant. First, a mirror is a <em>huge</em> step up from an external hard-drive in terms of reliability [<span class="blue">citation needed</span>]. Second, a <span class="caps">NAS</span> provides many benefits over an external hard-drive, so fault tolerance can&#8217;t be the only consideration. Snapshotting is something people just don&#8217;t do with external drives, music and video streaming can transform a&nbsp;house.</p>
<p>It also turns out that home users are pretty bad at gauging how much storage they&#8217;re going to need in the future, especially with drives growing in size. In 3 years, you can probably by drives twice as big but for a similar price. So by delaying the purchase, you can now copy the data off your old mirror onto a new mirror with twice the size - future problems solved. If you run out of space before that, just add another mirror. It&#8217;s slightly less failure tolerant and space efficient than <span class="caps">RAIDZ2</span>, but enough with the <a href="http://tvtropes.org/pmwiki/pmwiki.php/Main/MinMaxing">min-maxing</a> - is <em>maybe</em> saving £/$/€60 really worth this hassle? Flexibility is&nbsp;underestimated.</p>
<hr>
<p>In any case, <span class="caps">RAIDZ2</span> or a mirror, you should be making regular backups. Backups that you trust. So in principle, you could buy two more drives, nuke your mirror, create a <span class="caps">RAIDZ2</span> array and restore from your backup, right? Sounds crazy? That&#8217;s because backups are&nbsp;hard.</p>
<p>I think this is the real issue. Off-site backups of <em>muy grande</em> amounts of data is expensive <sup id="fnref-1"><a class="footnote-ref" href="#fn-1">1</a></sup>. Something like <a href="https://aws.amazon.com/glacier/pricing/">Amazon Glacier</a> is the right direction, but still way to expensive if your house burns down. I looked into tape drives, weirdly they are still obscenely expensive. For that amount of money, you might as well put another <span class="caps">NAS</span> in a different location or just pay Amazon or some other cloud&nbsp;provider.</p>
<hr>
<p>Interestingly, I can&#8217;t find a cloud provider that&#8217;ll let you store data with them, but to get it back you can buy a drive from then with your data on it. Imagine Amazon Glacier, but if you need the data back they go: &#8220;Okay, your house burned down. In two weeks, we&#8217;ll send you <x> drives with your data on them&#8221;. I think there&#8217;s potential there, although in this day and age two weeks is probably pushing the patience of most people. But it&#8217;s that really limited use-case of a lot of data which hopefully you&#8217;ll never need to&nbsp;access.</p>
<p>Let me know if you have any nifty solutions or&nbsp;providers.</p>
<div class="footnote">
<hr>
<ol>
<li id="fn-1">
<p>(reliability x amount) / (effort) = cost, and there&#8217;s very few things where this doesn&#8217;t apply. I think &#8220;enterprise&#8221; is shorthand for that formula.&#160;<a class="footnote-backref" href="#fnref-1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
</article>
<section>
  <p><span class="fa fa-tags"></span> <a href="/tag/ZFS/">ZFS</a>, <a href="/tag/FreeNAS/">FreeNAS</a>, <a href="/tag/NAS/">NAS</a>, <a href="/tag/storage/">storage</a></p>
  <a href="/2016/01/ansible-2.0-launched/" class="older"><span class="fa fa-chevron-circle-left"></span> Older</a>
</section>
<!-- content end -->
    <footer>
      <hr />
      <p>
        <span class="fa fa-child fa-fw"></span>Born naked, helpless, and unable to fend for himself, Toby eventually overcame these handicaps to become a code craftsman, tinkerer, and musician. He posts his ramblings here. Toby currently lives in England.
      </p>
      <p class="cap">
        <span class="fa fa-copyright fa-fw"></span><span class="date">mmxii&ndash;mmxvi</span> <span class="name">Toby Fleming</span>
      </p>
    </footer>
  </div>
</body>
</html>